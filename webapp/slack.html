<html ng-app="slackApp">
  <head>
    <meta charset="utf-8">
    <title>Slack Mock Project</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="slack.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-route.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.1/angular-cookies.js"></script>

    <script>

    var slackApp = angular.module('slackApp', ['ngRoute', 'ngCookies']);
    
    slackApp.config(function($routeProvider) {
        $routeProvider.
          when('/', {
            templateUrl: 'home.html',
            controller: 'HomeCtrl'
          }).
          when('/channel.html', {
            templateUrl: 'channel.html',
            controller: 'ChannelCtrl'

          }).
          when('/Teams.html', {
            templateUrl: 'Teams.html',
            controller: 'TeamCtrl'

          }).
          when('/administration.html', {
            templateUrl: 'administration.html',
            controller: 'AdministrationCtrl'

          }).
          otherwise({
            redirectTo: '/'
          });
      });

      //var channels = [];
      slackApp.controller('ChannelCtrl', function  ($scope, $http, $cookieStore, $window){
          $scope.userId = $cookieStore.get('userId'); 
           $http.get('/channel/user/' + $scope.userId).success(function(data) {
              $scope.channels = data;
           });

       
        $scope.IsEnter=function(event){
            if (event.keyCode===13){                                       
                 $scope.bNew=true
                document.getElementById("txtChannel").value = "";
                $scope.channels.push({"channel":$scope.newChannel});
           
               $scope.SaveChannel2DB({"userId":$scope.userId, "channelName":$scope.newChannel});         
            }
         };


        $scope.SaveChannel2DB=function(channelData){
          console.log(messageData);
          $http.post('/channel/channel', channelData).success(function (data,status, headers, config) {
                $scope.PostDataResponse = data;
                console.log ("success saving channel:"+ data);
            })
            .error(function (data, status, headers, config) {
              console.log("failed to save channel");
            });

        };
    });







 slackApp.controller('TeamCtrl', function  ($scope, $http,$routeParams, $cookieStore, $window){
          $scope.userId = $cookieStore.get('userId'); 
           $http.get('/team/team' ).success(function(data) {
              $scope.teams = data;
              console.log(data);
           });

            // $http.get('/channel/channel' ).success(function(data) {
            //   $scope.channels = data;
            //   console.log(data);      
            // });

       
        $scope.IsEnter=function(event){
            if (event.keyCode===13){                                       
               //  $scope.bNew=true
                document.getElementById("txtTeam").value = "";
                $scope.teams.push({"teamId": "", "teamName":$scope.newTeam});
           
               $scope.SaveTeam2DB({"teamName":$scope.newTeam});         
            }
         };

        //  $scope.showChannels=function (teamClicked){
        //       $scope.bTeamClicked=true;
          
                       
        //       $scope.teamName=teamClicked;
        //       $scope.$apply
        //  };


        $scope.SaveTeam2DB=function(teamData){
          console.log(teamData);
           $http.post('/team/newTeam', teamData).success(function (data,status, headers, config) {
          //       $scope.PostDataResponse = data;
                console.log ("success saving team:"+ data);
            })
            .error(function (data, status, headers, config) {
              console.log("failed to save team");
            });

        };


        slackApp.controller('AdministrationCtrl', function  ($scope, $http,$routeParams, $cookieStore, $window) {


        });








      slackApp.controller('HomeCtrl', function ($scope, $http, $cookieStore, $window){
        //$scope.channels = [];
        $scope.userId = $cookieStore.get('userId');
          console.log($scope.userId);
          if(!$scope.userId) {
            $window.location.href = '/login.html';
          }
          else {
            $http.get('/channel/user/' + $scope.userId).success(function(data) {
              $scope.channels = data;
              $scope.getChannelMessage($scope.channels[0].id);         
            });

              $http.get('/user/user/' + $scope.userId).success(function (data){
                 //    console.log ("got user name");
                    $scope.userName=data[0].userName;
                 console.log("name--" + $scope.userName);
              });

          }
     

        $scope.getChannelMessage = function(channel) {
          console.log(channel);
          $scope.channel=channel;
          $http.get('/message/channel/' + channel).success(function(data) {
            $scope.messages = data;
            console.log($scope.messages);
          });


         
        };

        $scope.Save2DB=function(messageData){
          
          $http.post('/message/message', messageData).success(function (data,status, headers, config) {
                $scope.PostDataResponse = data;
                console.log ("success:"+ data);
            })
            .error(function (data, status, headers, config) {
              console.log("failed to save");
            });

        };

         $scope.IsEnter=function(event){
          // console.log (" a keypress");
        
             if (event.keyCode===13){
              
              var currentdate = new Date();
             var datetime = currentdate.getDay() + "/"+currentdate.getMonth() 
              + "/" + currentdate.getFullYear() + " " 
              + currentdate.getHours() + ":" 
                + currentdate.getMinutes() + ":" + currentdate.getSeconds();
                console.log ($scope.msg);
                          
               $scope.messages.push({"userName":$scope.userName, "date":datetime, "msg":$scope.msg});

              document.getElementById("txtMsg").value = "";

              
               $scope.Save2DB({"userId":$scope.userId, "channelId":$scope.channel, "msg":$scope.msg});         
            
            }
         };
    });

    slackApp.controller('AdministrationCtrl', function ($scope, $http, $cookieStore, $window) {

    });


</script>

  </head>

  <body>

    <div ng-include="'header.html'"></div>

    <div ng-view></div>


    <div ng-include="'footer.html'"></div>

  </body>
</html>
